#Simulation And Estimation of GARCH(1,1)
--What are we talking about when we talk about fit?

This project aims to find out the reasoning for the estimation of GARCH model. 
First, we simulate a GARCH(1,1) process with arbitrary parameters. Then we illustrate how to fit the model with MLE and GMM.
Then we compare the parameters from the fitted result to the arbitraged one. Then we apply them to empircal data. 

##Simulate a GARCH process. 
Simulate a GARCH process.

$$
\sigma_t^2 = \omega+\alpha r_{t-1}^2+\beta \sigma^2_{t-1}\\
r_t = \sigma_t \epsilon_t \\
\epsilon_{t} \sim \mathcal{N}(0,1)\\
$$
We set the parameters as following: 
$$
\omega = 1\\
\alpha = 0.3\\
\beta = 0.5\\
\sigma_0 = \sqrt{\frac{1}{1-\alpha-\beta}}
$$

```{r}
omega <- 1
alpha <- 0.3
beta <- 0.5
sigma1 <- sqrt(1/(1-alpha-beta))
# N numbers of simulations
N <- 11000
```

Define our simulation function.

```{r}
simulate_garch <- function(omega,alpha,beta,sigma1,N){
  rs <- c(sigma1*rnorm(1))
  sigmas <- c(sigma1)
  for (i in 1:N-1) {
    #Simulate the epsilon
    epsilon <- rnorm(1)
    #Simulate the next r and put it in the bin.
    r <- sigmas[i]*epsilon
    rs <- c(rs,r)
    #Simulate the sigma
    sigma <- sqrt(omega+alpha*r**2+beta*sigmas[i]**2)
    sigmas <- c(sigmas,sigma)
  }
  simulation_result <- data.frame(
    sigmas = sigmas,
    index = c(1:N-1000),
    r = rs
  )
  simulation_result = tail(simulation_result,-1000)
  return(simulation_result)
}
simulation_result <- simulate_garch(omega,alpha,beta,sigma1,N)

library(ggplot2)
theme_set(theme_classic())
ggplot(data=simulation_result,aes(x=index, y=sigmas, group=1)) +
  geom_line(color="red")+
labs(title="GARCH(1,1) Simulation",
       caption="Source: Simulation",
       y="Sigma")
# ggplot2::ggsave("GARCH_simulations.jpg")
```
Next,we fit the model with rugarch packages as benchmark.
```{r}
library(rugarch)
garchSpec <- ugarchspec(
  variance.model=list(model="sGARCH", garchOrder=c(1,1)),
  mean.model=list(armaOrder = c(0,0),include.mean=F))
fit = ugarchfit(spec = garchSpec, data = simulation_result$r)
print(fit)
```
##Fit simulated data using MLE.
First, we derieve the likelihood of GARCH(1,1)
$$
r \sim \mathcal{N}(0,\sigma_t^2)\\
\theta = [\omega,\alpha,\beta]\\
f(r_0,r_1,\cdots ,r_t;\theta) = f(r_0;\theta)f(r_t|r_{t-1},\cdots, r_1;\theta)\\
=f(r_0;\theta)f(r_t|r_{t-1},\cdots, r_1;\theta)\\
=f(r_0;\theta)\Pi_{t=1}^{T} f(r_t|R_{t-1};\theta)\\
=f(r_0;\theta)\Pi_{t=1}^{T} \frac{1}{\sqrt{2\pi\sigma_t^2}}exp(-\frac{r_t^2}{2\sigma_t^2})\\
$$
Then we drop the first term $f(r_0;\theta)$ because it is a constant, and then take a log, then we have the log-likelihood function:
$$
\mathcal{L}(\theta) = \sum_{t=1}^{T} -\frac{1}{2} [ln(2\pi)+ln(\sigma_t^2) +\frac{r_t^2}{\sigma_t^2}]
$$
After we have the log-likelihood function, our objective would be find a vector $\theta$ that can maximize $\mathcal{L(\theta)}$. 
Note that we also have three constraints:
$$
\alpha\ge0;\beta\ge0;\alpha+\beta<1
$$

```{r}

```



































###Empircal Data
1. Read the data first. 
```{r}
gspc <- read.csv('GSPC.csv')
vix <- read.csv('VIX.csv')
#Only Use Close price
gspc <- data.frame(
  Date = as.Date.factor(gspc$Date),
  Price = gspc$Close
)
Date = as.Date.factor(gspc$Date)
vix <- data.frame(
  Date = as.Date.factor(vix$Date),
  Price = vix$Close
)
```





































